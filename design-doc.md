## Design Docs

### User Stories

- **Initial Setup**:
    - As a new user I want to run a setup script that takes my information and populates the database.
- **Morning Routine**:
    - As a user I want a morning cronjob to force me to interact with the app to pull me into an intentional space. This should ask me to remember my dreams before anything else, then remind me of my successes and failures from the previous day. It should then ask me to set one or two main intentions for my day today.
- **Evening Routine**:
    - As a user I want an evening cronjob to force me to report my successes/failures through the day. I want to answer important questions about learning (to re-enforce what I learned and store it), my diet and exercise, what I feel I did well, how my mood is/was, and if I met my intentional goals for the day. 
    - I want this evening routine to automatically generate a journal entry and add it to my notes.
- **Management**:
    - I want to be able to enter foods and build meals from them. This can be a seperate script for simplicity sake.
    - I want to do the same with exercises and workouts. I want to enter exercises and build workouts from them.
    - This should expediate the entry of repeat items in the evening routine so it never feels like a chore.

### Technologies Used

- **Programming Language:** Python 3.10+
    - Chosen for its readability, extensive standard library, and rich third-party package ecosystem, making it ideal for rapid development of console applications.

- **Database:** SQLite3
    - Selected for its serverless, self-contained, and zero-configuration nature, which is perfect for a local-first, single-user desktop application. The database will be a single file on the user's machine.

- **Operating System:** Ubuntu 24.04 LTS
    - The target platform for development and deployment, providing a stable, long-term support environment.

- **Automation/Scheduling:** cron
    - The standard, time-based job scheduler in Unix-like operating systems. It will be used to automatically trigger the morning and evening journal scripts at user-defined times.

- **Primary Python Libraries:**
    - **`sqlite3`**: (Standard Library) For all direct interaction with the SQLite database.
    - **`questionary`**: A third-party library for building polished, interactive command-line prompts, menus, and confirmations, enhancing the user experience.
    - **`pathlib`**: (Standard Library) For modern, object-oriented handling of filesystem paths, ensuring cross-platform compatibility if ever needed.
    - **`datetime`**: (Standard Library) For handling all date and time operations, crucial for logging and scheduling.

- **Future-Facing Libraries (for v1.0+):**
    - **`sentence-transformers`**: A third-party library for generating high-quality vector embeddings from text descriptions (learning logs, ELOs) for future semantic search and RAG integrations.
    - **`numpy`**: A foundational third-party library for numerical operations, primarily for handling and manipulating the vector data generated by `sentence-transformers`.

### Folder Structure

wolf-tracker/
├── .gitignore
├── README.md
├── main.py
├── config.ini
├── requirements.txt
├── venv/
└── app/
    ├── __init__.py
    ├── database.py
    ├── logic.py
    ├── models.py
    ├── ui.py
    └── reporting.py

### Class Design

`app/database.py`

```python
class DatabaseManager:
    """Handles all database connections and CRUD operations."""

    def __init__(self, db_path: str):
        """Initializes the DatabaseManager with the path to the SQLite database."""
        pass

    def connect(self):
        """Establishes the database connection."""
        pass

    def close(self):
        """Closes the database connection."""
        pass

    def create_tables(self):
        """Executes the full SQL schema to create all tables if they don't exist."""
        pass

    def get_schema_version(self) -> int:
        """Retrieves the current schema version from the database."""
        pass

    def set_schema_version(self, version: int):
        """Updates the schema version number."""
        pass

    # --- User Profile Methods ---
    def create_or_update_user_profile(self, profile_data: dict):
        """Saves or updates the single user profile."""
        pass

    def get_user_profile(self) -> dict:
        """Retrieves the user profile."""
        pass

    # --- Daily Log Methods ---
    def ensure_daily_log_exists(self, log_date: str):
        """Creates a daily_log entry for the given date if one doesn't already exist."""
        pass

    def save_morning_log(self, log_date: str, dreams: str, intentions: str):
        """Saves the morning-specific data to the daily_log."""
        pass

    def save_evening_log(self, log_date: str, review: str, accomplishment: str, mood: str):
        """Saves the evening-specific data to the daily_log."""
        pass
    
    def get_yesterdays_intentions(self, today_date: str) -> str:
        """Fetches the intentions from the previous day's log."""
        pass

    # --- Nutrition Methods ---
    def add_food_item(self, food_data: dict) -> int:
        """Adds a new food to the food_items table."""
        pass

    def get_all_food_items(self) -> list[dict]:
        """Retrieves all food items."""
        pass

    def log_nutrition_entry(self, log_date: str, food_id: int, quantity: float):
        """Adds a row to the nutrition_log table."""
        pass
        
    def get_meal_components(self, meal_id: int) -> list[dict]:
        """Retrieves all food_ids and quantities for a given recurring meal."""
        pass

    # --- NEW Workout Methods ---
    def add_exercise(self, name: str, calories: int) -> int:
        """Adds a single exercise to the exercises table."""
        pass

    def get_all_exercises(self) -> list[dict]:
        """Retrieves all defined exercises."""
        pass

    def create_workout(self, name: str) -> int:
        """Creates a new workout in the workouts table and returns its ID."""
        pass

    def get_all_workouts(self) -> list[dict]:
        """Retrieves all defined workouts."""
        pass
        
    def add_exercise_to_workout(self, workout_id: int, exercise_id: int):
        """Links an exercise to a workout in the workout_components table."""
        pass
        
    def get_workout_calorie_sum(self, workout_id: int) -> int:
        """
        Calculates the total calorie burn for a workout by summing its
        component exercises directly in the database.
        """
        pass

    # --- Data Retrieval for Reporting ---
    def get_all_data_for_date(self, log_date: str) -> dict:
        """
        Fetches all data related to a specific date from multiple tables.
        Returns a dictionary containing keys like 'daily_log', 'nutrition', 'workout', 'weight'.
        """
        pass
```

`app/logic.py`

```python
class ReportLogic:
    """Handles business logic, calculations, and data aggregation for reports."""

    def __init__(self, db_manager: DatabaseManager):
        """Initializes the logic class with a database manager instance."""
        pass

    def calculate_bmr(self, profile: dict, weight_lbs: float) -> float:
        """Calculates Basal Metabolic Rate using the Mifflin-St Jeor equation."""
        pass

    def calculate_tdee(self, bmr: float, activity_calories: int) -> float:
        """
        Calculates Total Daily Energy Expenditure.
        Assumes a sedentary base and adds explicit activity.
        """
        pass

    def estimate_current_weight(self, last_measured_weight: float, calorie_logs: list) -> float:
        """
        Calculates an estimated current weight based on the last known measurement
        and the calorie surplus/deficit since that date. THIS IS FOR DISPLAY ONLY.
        """
        # Logic will sum the daily surplus/deficit from calorie_logs
        # and convert the total calorie difference to an estimated weight change.
        # (e.g., assuming ~3500 calories per pound)
        pass

    def get_daily_summary(self, log_date: str) -> dict:
        """
        Orchestrates the creation of the final data summary for a given day.
        1. Fetches all raw data from the DatabaseManager.
        2. Calculates nutrition totals (calories, macros).
        3. Fetches the logged workout_id and calls get_workout_calorie_sum() to get the total.
        4. Calculates BMR and TDEE.
        5. Calculates calorie deficit/surplus.
        6. Returns a single, comprehensive, structured dictionary ready for reporting.
        """
        pass
```

`app/ui.py`

```python
class ConsoleUI:
    """Handles all console input and output using the 'questionary' library."""

    def __init__(self):
        """Initializes the user interface."""
        pass

    # --- Main Routines ---
    def run_morning_prompts(self, yesterdays_intentions: str) -> dict:
        """
        Displays yesterday's intentions and prompts the user for dreams and today's intentions.
        Returns a dictionary of the user's input.
        """
        pass

    def run_evening_prompts(self, db_manager: DatabaseManager) -> dict:
        """
        Runs the series of evening questions: what learned, water, nutrition, workout, etc.
        For nutrition and workouts, it will call other methods to show selection menus.
        Returns a dictionary containing all evening data.
        - At the start of the nutrition section, it will ask:
          "Log the same meals as yesterday? [Y/n]"
        - At the start of the workout section, it will ask:
          "Log the same workout as yesterday? [Y/n]"
        Should also be mindful of other efficiency gains to improve user engagement.
        """
        pass

    # --- Management Menus ---
    def manage_food_items_menu(self, db_manager: DatabaseManager):
        """Presents a menu to Add, View, or Delete items in the 'food_items' table."""
        pass

    def manage_recurring_meals_menu(self, db_manager: DatabaseManager):
        """Presents a menu to Create, View, or Delete recurring meals."""
        pass

    def manage_workouts_menu(self, db_manager: DatabaseManager):
        """
        Presents a top-level menu for "Manage Exercises" or "Manage Workouts".
        - "Manage Exercises" will have Add/View/Delete options for the exercises table.
        - "Manage Workouts" will have Create/View/Delete options. When creating,
          it will prompt the user to select from the list of existing exercises.
        """
        pass
       
    # --- Helper Methods ---
    def prompt_for_user_profile(self) -> dict:
        """Prompts the user for their profile data (height, DOB, etc.) for the initial setup."""
        pass
```

`app/reporting.py`

```python
class MarkdownReporter:
    """Handles the formatting and saving of the final Markdown report."""

    def __init__(self):
        """Initializes the reporter."""
        pass

    def generate_report_string(self, summary_data: dict) -> str:
        """
        Takes the structured dictionary from ReportLogic and formats it into a Markdown string.
        """
        pass

    def save_report(self, report_string: str, directory: str) -> str:
        """
        Saves the report string to a file with the 'yyyymmddhhmmss.md' format.
        Returns the full path of the saved file.
        """
        pass
```

`app/models.py`

```python
from dataclasses import dataclass

@dataclass
class UserProfile:
    """Data model for the user_profile table."""
    height_cm: float
    birth_date: str
    sex_at_birth: str
    user_name: str = None

@dataclass
class DailySummary:
    """
    A structured model for the final aggregated data passed to the reporter.
    This helps ensure consistency between the logic and reporting layers.
    """
    log_date: str
    dreams: str
    intentions: str
    # ... other fields for nutrition totals, TDEE results, etc.
```

### Schema

```sqlite3
-- SQL Schema for Wolf Tracker (Journaling & Academic) - Final Version
-- Adapted for SQLite3
-- --------------------------------------------------------------------

--
-- Table: schema_version
-- Purpose: Tracks the current version of the database schema to handle migrations.
--
CREATE TABLE IF NOT EXISTS schema_version (
    version INTEGER PRIMARY KEY
);

--
-- Table: user_profile
-- Purpose: Store semi-permanent user data for TDEE calculations. Assumes a single user.
--
CREATE TABLE IF NOT EXISTS user_profile (
    profile_id INTEGER PRIMARY KEY,
    user_name TEXT,
    height_cm REAL NOT NULL,
    birth_date TEXT NOT NULL, -- YYYY-MM-DD format
    sex_at_birth TEXT NOT NULL -- 'Male' or 'Female' for BMR formulas
);

--
-- Table: daily_log
-- Purpose: The central anchor for a single day's summary events.
--
CREATE TABLE IF NOT EXISTS daily_log (
    log_date TEXT PRIMARY KEY, -- YYYY-MM-DD format, ensures one log summary per day
    dreams TEXT,
    intentions TEXT,
    review_of_intentions TEXT,
    accomplishment TEXT, -- One thing done well
    mood TEXT
);

--
-- Table: weight_log
-- Purpose: Track discrete weight entries over time.
--
CREATE TABLE IF NOT EXISTS weight_log (
    weight_id INTEGER PRIMARY KEY,
    log_date TEXT NOT NULL,
    weight_lbs REAL NOT NULL,
    FOREIGN KEY (log_date) REFERENCES daily_log (log_date) ON DELETE CASCADE
);

-- ======================================================
-- Learning & Vector Support
-- ======================================================

CREATE TABLE IF NOT EXISTS learning_log (
    learning_id INTEGER PRIMARY KEY,
    log_date TEXT NOT NULL,
    description TEXT NOT NULL,
    description_vector BLOB, -- For storing vector embeddings as bytes
    FOREIGN KEY (log_date) REFERENCES daily_log (log_date) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS expected_learning_outcomes (
    elo_id INTEGER PRIMARY KEY,
    course_id TEXT NOT NULL,
    description TEXT NOT NULL,
    description_vector BLOB, -- For storing vector embeddings as bytes
    FOREIGN KEY (course_id) REFERENCES courses (course_id) ON DELETE CASCADE
);

-- ======================================================
-- Nutrition Tracking System
-- ======================================================

CREATE TABLE IF NOT EXISTS food_items (
    food_id INTEGER PRIMARY KEY,
    name TEXT NOT NULL UNIQUE,
    calories INTEGER NOT NULL,
    protein_g REAL,
    carbs_g REAL,
    fat_g REAL
);

CREATE TABLE IF NOT EXISTS recurring_meals (
    meal_id INTEGER PRIMARY KEY,
    name TEXT NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS recurring_meal_components (
    meal_id INTEGER NOT NULL,
    food_id INTEGER NOT NULL,
    quantity REAL NOT NULL DEFAULT 1,
    PRIMARY KEY (meal_id, food_id),
    FOREIGN KEY (meal_id) REFERENCES recurring_meals (meal_id) ON DELETE CASCADE,
    FOREIGN KEY (food_id) REFERENCES food_items (food_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS nutrition_log (
    nutrition_id INTEGER PRIMARY KEY,
    log_date TEXT NOT NULL,
    food_id INTEGER NOT NULL,
    quantity REAL NOT NULL DEFAULT 1,
    FOREIGN KEY (log_date) REFERENCES daily_log (log_date) ON DELETE CASCADE,
    FOREIGN KEY (food_id) REFERENCES food_items (food_id)
);

-- ======================================================
-- Compositional Fitness Tracking System
-- ======================================================

--
-- Table: exercises
-- Purpose: Defines individual, reusable exercises with their caloric value.
--
CREATE TABLE IF NOT EXISTS exercises (
    exercise_id INTEGER PRIMARY KEY,
    name TEXT NOT NULL UNIQUE,
    calories_burned INTEGER NOT NULL -- Or REAL if you want decimal precision
);

--
-- Table: workouts
-- Purpose: Defines the name of a workout routine. The calorie total is calculated, not stored.
--
CREATE TABLE IF NOT EXISTS workouts (
    workout_id INTEGER PRIMARY KEY,
    name TEXT NOT NULL UNIQUE -- e.g., "Workout A", "Leg Day"
);

--
-- Table: workout_components
-- Purpose: A junction table linking workouts to their component exercises (Many-to-Many).
--
CREATE TABLE IF NOT EXISTS workout_components (
    workout_id INTEGER NOT NULL,
    exercise_id INTEGER NOT NULL,
    PRIMARY KEY (workout_id, exercise_id),
    FOREIGN KEY (workout_id) REFERENCES workouts (workout_id) ON DELETE CASCADE,
    FOREIGN KEY (exercise_id) REFERENCES exercises (exercise_id) ON DELETE CASCADE
);

--
-- Table: workout_log
-- Purpose: A simple log of which workout was completed on a given day. (This table remains the same).
--
CREATE TABLE IF NOT EXISTS workout_log (
    workout_log_id INTEGER PRIMARY KEY,
    log_date TEXT NOT NULL,
    workout_id INTEGER NOT NULL,
    FOREIGN KEY (log_date) REFERENCES daily_log (log_date) ON DELETE CASCADE,
    FOREIGN KEY (workout_id) REFERENCES workouts (workout_id)
);

-- ======================================================
-- Wolf Tracker Academic Schema
-- ======================================================

CREATE TABLE IF NOT EXISTS courses (
    course_id TEXT PRIMARY KEY,
    course_name TEXT NOT NULL,
    instructor TEXT,
    credits INTEGER NOT NULL
);

CREATE TABLE IF NOT EXISTS assignments (
    assignment_id INTEGER PRIMARY KEY,
    course_id TEXT NOT NULL,
    due_date TEXT NOT NULL,
    turned_in INTEGER NOT NULL DEFAULT 0, -- 0 for false, 1 for true
    date_turned_in TEXT,
    worth_weight REAL NOT NULL,
    mark REAL,
    description TEXT NOT NULL,
    FOREIGN KEY (course_id) REFERENCES courses (course_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS exams (
    exam_id INTEGER PRIMARY KEY,
    course_id TEXT NOT NULL,
    exam_date TEXT NOT NULL,
    done INTEGER NOT NULL DEFAULT 0,
    worth_weight REAL NOT NULL,
    mark REAL,
    description TEXT NOT NULL,
    FOREIGN KEY (course_id) REFERENCES courses (course_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS projects (
    project_id INTEGER PRIMARY KEY,
    course_id TEXT NOT NULL,
    due_date TEXT NOT NULL,
    turned_in INTEGER NOT NULL DEFAULT 0,
    date_turned_in TEXT,
    worth_weight REAL NOT NULL,
    mark REAL,
    description TEXT NOT NULL,
    FOREIGN KEY (course_id) REFERENCES courses (course_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS project_deliverables (
    deliverable_id INTEGER PRIMARY KEY,
    project_id INTEGER NOT NULL,
    due_date TEXT NOT NULL,
    done INTEGER NOT NULL DEFAULT 0,
    date_done TEXT,
    description TEXT NOT NULL,
    FOREIGN KEY (project_id) REFERENCES projects (project_id) ON DELETE CASCADE
);
```


